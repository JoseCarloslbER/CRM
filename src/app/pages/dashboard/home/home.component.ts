import { AfterViewInit, Component, OnDestroy, OnInit } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { MatDialog } from '@angular/material/dialog';
import { Router } from '@angular/router';
import { ApexOptions } from 'apexcharts';
import { Subject, takeUntil } from 'rxjs';
import { DashboardService } from '../dashboard.service';
import { CatalogsService } from 'app/shared/services/catalogs.service';
import * as entityGeneral from '../../../shared/interfaces/general-interface';
import * as entity from '../dashboard-interface';
import moment from 'moment';

@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.scss']
})
export class HomeComponent implements OnInit, AfterViewInit, OnDestroy {
  private onDestroy = new Subject<void>();

  public displayedColumnsRegister: string[] = [
    'name',
    'date',
    'country'
  ];

  public displayedColumnsClientsCountry: string[] = [
    'name',
    'amount',
  ];

  public data = {
    visitors: {
      series: {
        "this-year": [
          {
            name: "Visitors",
            data: [
              {
                "x": "2023-01-17T22:50:57.093Z",
                "y": 4884
              },
              {
                "x": "2023-01-20T22:50:57.093Z",
                "y": 5351
              },
              {
                "x": "2023-01-23T22:50:57.093Z",
                "y": 5293
              },
              {
                "x": "2023-01-26T22:50:57.093Z",
                "y": 4908
              },
              {
                "x": "2023-01-29T22:50:57.093Z",
                "y": 5027
              },
              {
                "x": "2023-02-01T22:50:57.093Z",
                "y": 4837
              },
              {
                "x": "2023-02-04T22:50:57.093Z",
                "y": 4484
              },
              {
                "x": "2023-02-07T22:50:57.093Z",
                "y": 4071
              },
              {
                "x": "2023-02-10T22:50:57.093Z",
                "y": 4124
              },
              {
                "x": "2023-02-13T22:50:57.093Z",
                "y": 4563
              },
              {
                "x": "2023-02-17T22:50:57.093Z",
                "y": 3820
              },
              {
                "x": "2023-02-20T22:50:57.093Z",
                "y": 3968
              },
              {
                "x": "2023-02-23T22:50:57.093Z",
                "y": 4102
              },
              {
                "x": "2023-02-26T22:50:57.093Z",
                "y": 3941
              },
              {
                "x": "2023-03-01T22:50:57.093Z",
                "y": 3566
              },
              {
                "x": "2023-03-04T22:50:57.093Z",
                "y": 3853
              },
              {
                "x": "2023-03-07T22:50:57.093Z",
                "y": 3853
              },
              {
                "x": "2023-03-10T22:50:57.093Z",
                "y": 4069
              },
              {
                "x": "2023-03-13T22:50:57.093Z",
                "y": 3879
              },
              {
                "x": "2023-03-16T22:50:57.093Z",
                "y": 4298
              },
              {
                "x": "2023-03-17T22:50:57.093Z",
                "y": 4355
              },
              {
                "x": "2023-03-20T22:50:57.093Z",
                "y": 4065
              },
              {
                "x": "2023-03-23T22:50:57.093Z",
                "y": 3650
              },
              {
                "x": "2023-03-26T22:50:57.093Z",
                "y": 3379
              },
              {
                "x": "2023-03-29T22:50:57.093Z",
                "y": 3191
              },
              {
                "x": "2023-04-01T22:50:57.093Z",
                "y": 2968
              },
              {
                "x": "2023-04-04T22:50:57.093Z",
                "y": 2957
              },
              {
                "x": "2023-04-07T22:50:57.093Z",
                "y": 3313
              },
              {
                "x": "2023-04-10T22:50:57.093Z",
                "y": 3708
              },
              {
                "x": "2023-04-13T22:50:57.093Z",
                "y": 3586
              },
              {
                "x": "2023-04-17T22:50:57.093Z",
                "y": 3965
              },
              {
                "x": "2023-04-20T22:50:57.093Z",
                "y": 3901
              },
              {
                "x": "2023-04-23T22:50:57.093Z",
                "y": 3410
              },
              {
                "x": "2023-04-26T22:50:57.093Z",
                "y": 3748
              },
              {
                "x": "2023-04-29T22:50:57.093Z",
                "y": 3929
              },
              {
                "x": "2023-05-02T22:50:57.093Z",
                "y": 3846
              },
              {
                "x": "2023-05-05T22:50:57.093Z",
                "y": 3771
              },
              {
                "x": "2023-05-08T22:50:57.093Z",
                "y": 4015
              },
              {
                "x": "2023-05-11T22:50:57.093Z",
                "y": 3589
              },
              {
                "x": "2023-05-14T22:50:57.093Z",
                "y": 3150
              },
              {
                "x": "2023-05-17T22:50:57.093Z",
                "y": 3050
              },
              {
                "x": "2023-05-20T22:50:57.093Z",
                "y": 2574
              },
              {
                "x": "2023-05-23T22:50:57.093Z",
                "y": 2823
              },
              {
                "x": "2023-05-26T22:50:57.093Z",
                "y": 2848
              },
              {
                "x": "2023-05-29T22:50:57.093Z",
                "y": 3000
              },
              {
                "x": "2023-06-01T22:50:57.093Z",
                "y": 3216
              },
              {
                "x": "2023-06-04T22:50:57.093Z",
                "y": 3299
              },
              {
                "x": "2023-06-07T22:50:57.093Z",
                "y": 3768
              },
              {
                "x": "2023-06-10T22:50:57.093Z",
                "y": 3524
              },
              {
                "x": "2023-06-13T22:50:57.093Z",
                "y": 3918
              },
              {
                "x": "2023-06-17T22:50:57.093Z",
                "y": 4145
              },
              {
                "x": "2023-06-20T22:50:57.093Z",
                "y": 4378
              },
              {
                "x": "2023-06-23T22:50:57.093Z",
                "y": 3941
              },
              {
                "x": "2023-06-26T22:50:57.093Z",
                "y": 3932
              },
              {
                "x": "2023-06-29T22:50:57.093Z",
                "y": 4380
              },
              {
                "x": "2023-07-02T22:50:57.093Z",
                "y": 4243
              },
              {
                "x": "2023-07-05T22:50:57.093Z",
                "y": 4367
              },
              {
                "x": "2023-07-08T22:50:57.093Z",
                "y": 3879
              },
              {
                "x": "2023-07-11T22:50:57.093Z",
                "y": 4357
              },
              {
                "x": "2023-07-14T22:50:57.093Z",
                "y": 4181
              },
              {
                "x": "2023-07-17T22:50:57.093Z",
                "y": 4619
              },
              {
                "x": "2023-07-20T22:50:57.093Z",
                "y": 4769
              },
              {
                "x": "2023-07-23T22:50:57.093Z",
                "y": 4901
              },
              {
                "x": "2023-07-26T22:50:57.093Z",
                "y": 4640
              },
              {
                "x": "2023-07-29T22:50:57.093Z",
                "y": 5128
              },
              {
                "x": "2023-08-01T22:50:57.093Z",
                "y": 5015
              },
              {
                "x": "2023-08-04T22:50:57.093Z",
                "y": 5360
              },
              {
                "x": "2023-08-07T22:50:57.093Z",
                "y": 5608
              },
              {
                "x": "2023-08-10T22:50:57.093Z",
                "y": 5272
              },
              {
                "x": "2023-08-13T22:50:57.093Z",
                "y": 5660
              },
              {
                "x": "2023-08-17T22:50:57.093Z",
                "y": 5836
              },
              {
                "x": "2023-08-20T22:50:57.093Z",
                "y": 5659
              },
              {
                "x": "2023-08-23T22:50:57.093Z",
                "y": 5575
              },
              {
                "x": "2023-08-26T22:50:57.093Z",
                "y": 5474
              },
              {
                "x": "2023-08-29T22:50:57.093Z",
                "y": 5427
              },
              {
                "x": "2023-09-01T22:50:57.093Z",
                "y": 5865
              },
              {
                "x": "2023-09-04T22:50:57.093Z",
                "y": 5700
              },
              {
                "x": "2023-09-07T22:50:57.093Z",
                "y": 6052
              },
              {
                "x": "2023-09-10T22:50:57.093Z",
                "y": 5760
              },
              {
                "x": "2023-09-13T22:50:57.093Z",
                "y": 5648
              },
              {
                "x": "2023-09-17T22:50:57.093Z",
                "y": 5435
              },
              {
                "x": "2023-09-20T22:50:57.093Z",
                "y": 5239
              },
              {
                "x": "2023-09-23T22:50:57.093Z",
                "y": 5452
              },
              {
                "x": "2023-09-26T22:50:57.093Z",
                "y": 5416
              },
              {
                "x": "2023-09-29T22:50:57.093Z",
                "y": 5195
              },
              {
                "x": "2023-10-02T22:50:57.093Z",
                "y": 5119
              },
              {
                "x": "2023-10-05T22:50:57.093Z",
                "y": 4635
              },
              {
                "x": "2023-10-08T22:50:57.093Z",
                "y": 4833
              },
              {
                "x": "2023-10-11T22:50:57.093Z",
                "y": 4584
              },
              {
                "x": "2023-10-14T22:50:57.093Z",
                "y": 4822
              },
              {
                "x": "2023-10-17T22:50:57.093Z",
                "y": 4582
              },
              {
                "x": "2023-10-20T22:50:57.093Z",
                "y": 4348
              },
              {
                "x": "2023-10-23T22:50:57.093Z",
                "y": 4132
              },
              {
                "x": "2023-10-26T22:50:57.093Z",
                "y": 4099
              },
              {
                "x": "2023-10-29T22:50:57.093Z",
                "y": 3849
              },
              {
                "x": "2023-11-01T22:50:57.093Z",
                "y": 4010
              },
              {
                "x": "2023-11-04T22:50:57.093Z",
                "y": 4486
              },
              {
                "x": "2023-11-07T22:50:57.093Z",
                "y": 4403
              },
              {
                "x": "2023-11-10T22:50:57.093Z",
                "y": 4141
              },
              {
                "x": "2023-11-13T22:50:57.093Z",
                "y": 3780
              },
              {
                "x": "2023-11-17T22:50:57.093Z",
                "y": 3524
              },
              {
                "x": "2023-11-20T22:50:57.093Z",
                "y": 3212
              },
              {
                "x": "2023-11-23T22:50:57.093Z",
                "y": 3568
              },
              {
                "x": "2023-11-26T22:50:57.093Z",
                "y": 3800
              },
              {
                "x": "2023-11-29T22:50:57.093Z",
                "y": 3796
              },
              {
                "x": "2023-12-02T22:50:57.093Z",
                "y": 3870
              },
              {
                "x": "2023-12-05T22:50:57.093Z",
                "y": 3745
              },
              {
                "x": "2023-12-08T22:50:57.093Z",
                "y": 3751
              },
              {
                "x": "2023-12-11T22:50:57.093Z",
                "y": 3310
              },
              {
                "x": "2023-12-14T22:50:57.093Z",
                "y": 3509
              },
              {
                "x": "2023-12-17T22:50:57.093Z",
                "y": 3187
              },
              {
                "x": "2023-12-20T22:50:57.093Z",
                "y": 2918
              },
              {
                "x": "2023-12-23T22:50:57.093Z",
                "y": 3191
              },
              {
                "x": "2023-12-26T22:50:57.093Z",
                "y": 3437
              },
              {
                "x": "2023-12-29T22:50:57.093Z",
                "y": 3291
              },
              {
                "x": "2024-01-01T22:50:57.093Z",
                "y": 3317
              },
              {
                "x": "2024-01-04T22:50:57.093Z",
                "y": 3716
              },
              {
                "x": "2024-01-07T22:50:57.093Z",
                "y": 3260
              },
              {
                "x": "2024-01-10T22:50:57.093Z",
                "y": 3694
              },
              {
                "x": "2024-01-13T22:50:57.093Z",
                "y": 3598
              }
            ]
          }
        ],
        "last-year": [
          {
            "name": "Visitors",
            "data": [
              {
                "x": "2022-01-17T22:50:57.093Z",
                "y": 2021
              },
              {
                "x": "2022-01-20T22:50:57.093Z",
                "y": 1749
              },
              {
                "x": "2022-01-23T22:50:57.093Z",
                "y": 1654
              },
              {
                "x": "2022-01-26T22:50:57.093Z",
                "y": 1900
              },
              {
                "x": "2022-01-29T22:50:57.093Z",
                "y": 1647
              },
              {
                "x": "2022-02-01T22:50:57.093Z",
                "y": 1315
              },
              {
                "x": "2022-02-04T22:50:57.093Z",
                "y": 1807
              },
              {
                "x": "2022-02-07T22:50:57.093Z",
                "y": 1793
              },
              {
                "x": "2022-02-10T22:50:57.093Z",
                "y": 1892
              },
              {
                "x": "2022-02-13T22:50:57.093Z",
                "y": 1846
              },
              {
                "x": "2022-02-17T22:50:57.093Z",
                "y": 1804
              },
              {
                "x": "2022-02-20T22:50:57.093Z",
                "y": 1778
              },
              {
                "x": "2022-02-23T22:50:57.093Z",
                "y": 2015
              },
              {
                "x": "2022-02-26T22:50:57.093Z",
                "y": 1892
              },
              {
                "x": "2022-03-01T22:50:57.093Z",
                "y": 1708
              },
              {
                "x": "2022-03-04T22:50:57.093Z",
                "y": 1711
              },
              {
                "x": "2022-03-07T22:50:57.093Z",
                "y": 1570
              },
              {
                "x": "2022-03-10T22:50:57.093Z",
                "y": 1507
              },
              {
                "x": "2022-03-13T22:50:57.093Z",
                "y": 1451
              },
              {
                "x": "2022-03-16T22:50:57.093Z",
                "y": 1522
              },
              {
                "x": "2022-03-17T22:50:57.093Z",
                "y": 1977
              },
              {
                "x": "2022-03-20T22:50:57.093Z",
                "y": 2367
              },
              {
                "x": "2022-03-23T22:50:57.093Z",
                "y": 2798
              },
              {
                "x": "2022-03-26T22:50:57.093Z",
                "y": 3080
              },
              {
                "x": "2022-03-29T22:50:57.093Z",
                "y": 2856
              },
              {
                "x": "2022-04-01T22:50:57.093Z",
                "y": 2745
              },
              {
                "x": "2022-04-04T21:50:57.093Z",
                "y": 2750
              },
              {
                "x": "2022-04-07T21:50:57.093Z",
                "y": 2728
              },
              {
                "x": "2022-04-10T21:50:57.093Z",
                "y": 2436
              },
              {
                "x": "2022-04-13T21:50:57.093Z",
                "y": 2289
              },
              {
                "x": "2022-04-17T21:50:57.093Z",
                "y": 2804
              },
              {
                "x": "2022-04-20T21:50:57.093Z",
                "y": 2777
              },
              {
                "x": "2022-04-23T21:50:57.093Z",
                "y": 3024
              },
              {
                "x": "2022-04-26T21:50:57.093Z",
                "y": 2657
              },
              {
                "x": "2022-04-29T21:50:57.093Z",
                "y": 2218
              },
              {
                "x": "2022-05-02T21:50:57.093Z",
                "y": 1964
              },
              {
                "x": "2022-05-05T21:50:57.093Z",
                "y": 1674
              },
              {
                "x": "2022-05-08T21:50:57.093Z",
                "y": 1721
              },
              {
                "x": "2022-05-11T21:50:57.093Z",
                "y": 2005
              },
              {
                "x": "2022-05-14T21:50:57.093Z",
                "y": 1613
              },
              {
                "x": "2022-05-17T21:50:57.093Z",
                "y": 1071
              },
              {
                "x": "2022-05-20T21:50:57.093Z",
                "y": 1079
              },
              {
                "x": "2022-05-23T21:50:57.093Z",
                "y": 1133
              },
              {
                "x": "2022-05-26T21:50:57.093Z",
                "y": 1536
              },
              {
                "x": "2022-05-29T21:50:57.093Z",
                "y": 2016
              },
              {
                "x": "2022-06-01T21:50:57.093Z",
                "y": 2256
              },
              {
                "x": "2022-06-04T21:50:57.093Z",
                "y": 1934
              },
              {
                "x": "2022-06-07T21:50:57.093Z",
                "y": 1832
              },
              {
                "x": "2022-06-10T21:50:57.093Z",
                "y": 2075
              },
              {
                "x": "2022-06-13T21:50:57.093Z",
                "y": 1709
              },
              {
                "x": "2022-06-17T21:50:57.093Z",
                "y": 1831
              },
              {
                "x": "2022-06-20T21:50:57.093Z",
                "y": 1434
              },
              {
                "x": "2022-06-23T21:50:57.093Z",
                "y": 1293
              },
              {
                "x": "2022-06-26T21:50:57.093Z",
                "y": 1064
              },
              {
                "x": "2022-06-29T21:50:57.093Z",
                "y": 1080
              },
              {
                "x": "2022-07-02T21:50:57.093Z",
                "y": 1032
              },
              {
                "x": "2022-07-05T21:50:57.093Z",
                "y": 1280
              },
              {
                "x": "2022-07-08T21:50:57.093Z",
                "y": 1344
              },
              {
                "x": "2022-07-11T21:50:57.093Z",
                "y": 1835
              },
              {
                "x": "2022-07-14T21:50:57.093Z",
                "y": 2287
              },
              {
                "x": "2022-07-17T21:50:57.093Z",
                "y": 2692
              },
              {
                "x": "2022-07-20T21:50:57.093Z",
                "y": 2250
              },
              {
                "x": "2022-07-23T21:50:57.093Z",
                "y": 1814
              },
              {
                "x": "2022-07-26T21:50:57.093Z",
                "y": 1906
              },
              {
                "x": "2022-07-29T21:50:57.093Z",
                "y": 1973
              },
              {
                "x": "2022-08-01T21:50:57.093Z",
                "y": 1882
              },
              {
                "x": "2022-08-04T21:50:57.093Z",
                "y": 2333
              },
              {
                "x": "2022-08-07T21:50:57.093Z",
                "y": 2048
              },
              {
                "x": "2022-08-10T21:50:57.093Z",
                "y": 2547
              },
              {
                "x": "2022-08-13T21:50:57.093Z",
                "y": 2884
              },
              {
                "x": "2022-08-17T21:50:57.093Z",
                "y": 2771
              },
              {
                "x": "2022-08-20T21:50:57.093Z",
                "y": 2522
              },
              {
                "x": "2022-08-23T21:50:57.093Z",
                "y": 2543
              },
              {
                "x": "2022-08-26T21:50:57.093Z",
                "y": 2413
              },
              {
                "x": "2022-08-29T21:50:57.093Z",
                "y": 2002
              },
              {
                "x": "2022-09-01T21:50:57.093Z",
                "y": 1838
              },
              {
                "x": "2022-09-04T21:50:57.093Z",
                "y": 1830
              },
              {
                "x": "2022-09-07T21:50:57.093Z",
                "y": 1872
              },
              {
                "x": "2022-09-10T21:50:57.093Z",
                "y": 2246
              },
              {
                "x": "2022-09-13T21:50:57.093Z",
                "y": 2171
              },
              {
                "x": "2022-09-17T21:50:57.093Z",
                "y": 2988
              },
              {
                "x": "2022-09-20T21:50:57.093Z",
                "y": 2694
              },
              {
                "x": "2022-09-23T21:50:57.093Z",
                "y": 2806
              },
              {
                "x": "2022-09-26T21:50:57.093Z",
                "y": 3040
              },
              {
                "x": "2022-09-29T21:50:57.093Z",
                "y": 2898
              },
              {
                "x": "2022-10-02T21:50:57.093Z",
                "y": 3013
              },
              {
                "x": "2022-10-05T21:50:57.093Z",
                "y": 2760
              },
              {
                "x": "2022-10-08T21:50:57.093Z",
                "y": 3021
              },
              {
                "x": "2022-10-11T21:50:57.093Z",
                "y": 2688
              },
              {
                "x": "2022-10-14T21:50:57.093Z",
                "y": 2572
              },
              {
                "x": "2022-10-17T21:50:57.093Z",
                "y": 2789
              },
              {
                "x": "2022-10-20T21:50:57.093Z",
                "y": 3069
              },
              {
                "x": "2022-10-23T21:50:57.093Z",
                "y": 3142
              },
              {
                "x": "2022-10-26T21:50:57.093Z",
                "y": 3614
              },
              {
                "x": "2022-10-29T21:50:57.093Z",
                "y": 3202
              },
              {
                "x": "2022-11-01T22:50:57.093Z",
                "y": 2730
              },
              {
                "x": "2022-11-04T22:50:57.093Z",
                "y": 2951
              },
              {
                "x": "2022-11-07T22:50:57.093Z",
                "y": 3267
              },
              {
                "x": "2022-11-10T22:50:57.093Z",
                "y": 2882
              },
              {
                "x": "2022-11-13T22:50:57.093Z",
                "y": 2885
              },
              {
                "x": "2022-11-17T22:50:57.093Z",
                "y": 2915
              },
              {
                "x": "2022-11-20T22:50:57.093Z",
                "y": 2790
              },
              {
                "x": "2022-11-23T22:50:57.093Z",
                "y": 3071
              },
              {
                "x": "2022-11-26T22:50:57.093Z",
                "y": 2802
              },
              {
                "x": "2022-11-29T22:50:57.093Z",
                "y": 2382
              },
              {
                "x": "2022-12-02T22:50:57.093Z",
                "y": 1883
              },
              {
                "x": "2022-12-05T22:50:57.093Z",
                "y": 1448
              },
              {
                "x": "2022-12-08T22:50:57.093Z",
                "y": 1176
              },
              {
                "x": "2022-12-11T22:50:57.093Z",
                "y": 1275
              },
              {
                "x": "2022-12-14T22:50:57.093Z",
                "y": 1136
              },
              {
                "x": "2022-12-17T22:50:57.093Z",
                "y": 1160
              },
              {
                "x": "2022-12-20T22:50:57.093Z",
                "y": 1524
              },
              {
                "x": "2022-12-23T22:50:57.093Z",
                "y": 1305
              },
              {
                "x": "2022-12-26T22:50:57.093Z",
                "y": 1725
              },
              {
                "x": "2022-12-29T22:50:57.093Z",
                "y": 1850
              },
              {
                "x": "2023-01-01T22:50:57.093Z",
                "y": 2304
              },
              {
                "x": "2023-01-04T22:50:57.093Z",
                "y": 2187
              },
              {
                "x": "2023-01-07T22:50:57.093Z",
                "y": 2597
              },
              {
                "x": "2023-01-10T22:50:57.093Z",
                "y": 2246
              },
              {
                "x": "2023-01-13T22:50:57.093Z",
                "y": 1767
              }
            ]
          }
        ]
      }
    },
    "conversions": {
      "amount": 4123,
      "labels": [
        "30 Nov - 07 Dec",
        "08 Dec - 15 Dec",
        "16 Dec - 23 Dec",
        "24 Dec - 31 Dec",
        "01 Jan - 08 Jan",
        "09 Jan - 16 Jan"
      ],
      "series": [
        {
          "name": "Conversions",
          "data": [
            4412,
            4345,
            4541,
            4677,
            4322,
            4123
          ]
        }
      ]
    },
    "impressions": {
      "amount": 46085,
      "labels": [
        "16 Dec - 23 Dec",
        "24 Dec - 31 Dec",
        "01 Jan - 08 Jan",
        "09 Jan - 16 Jan"
      ],
      "series": [
        {
          "name": "Impressions",
          "data": [
            11577,
            11441,
            11544,
            11523
          ]
        }
      ]
    },
    "visits": {
      "amount": 62083,
      "labels": [
        "16 Dec - 23 Dec",
        "24 Dec - 31 Dec",
        "01 Jan - 08 Jan",
        "09 Jan - 16 Jan"
      ],
      "series": [
        {
          "name": "Visits",
          "data": [
            15521,
            15519,
            15522,
            15521
          ]
        }
      ]
    },
    "visitorsVsPageViews": {
      "overallScore": 472,
      "averageRatio": 45,
      "predictedRatio": 55,
      "series": [
        {
          "name": "Page Views",
          "data": [
            {
              "x": "2023-11-12T22:50:57.093Z",
              "y": 4769
            },
            {
              "x": "2023-11-13T22:50:57.093Z",
              "y": 4901
            },
            {
              "x": "2023-11-14T22:50:57.093Z",
              "y": 4640
            },
            {
              "x": "2023-11-15T22:50:57.093Z",
              "y": 5128
            },
            {
              "x": "2023-11-16T22:50:57.093Z",
              "y": 5015
            },
            {
              "x": "2023-11-17T22:50:57.093Z",
              "y": 5360
            },
            {
              "x": "2023-11-18T22:50:57.093Z",
              "y": 5608
            },
            {
              "x": "2023-11-19T22:50:57.093Z",
              "y": 5272
            },
            {
              "x": "2023-11-20T22:50:57.093Z",
              "y": 5660
            },
            {
              "x": "2023-11-21T22:50:57.093Z",
              "y": 6026
            },
            {
              "x": "2023-11-22T22:50:57.093Z",
              "y": 5836
            },
            {
              "x": "2023-11-23T22:50:57.093Z",
              "y": 5659
            },
            {
              "x": "2023-11-24T22:50:57.093Z",
              "y": 5575
            },
            {
              "x": "2023-11-25T22:50:57.093Z",
              "y": 5474
            },
            {
              "x": "2023-11-26T22:50:57.093Z",
              "y": 5427
            },
            {
              "x": "2023-11-27T22:50:57.093Z",
              "y": 5865
            },
            {
              "x": "2023-11-28T22:50:57.093Z",
              "y": 5700
            },
            {
              "x": "2023-11-29T22:50:57.093Z",
              "y": 6052
            },
            {
              "x": "2023-11-30T22:50:57.093Z",
              "y": 5760
            },
            {
              "x": "2023-12-01T22:50:57.093Z",
              "y": 5648
            },
            {
              "x": "2023-12-02T22:50:57.093Z",
              "y": 5510
            },
            {
              "x": "2023-12-03T22:50:57.093Z",
              "y": 5435
            },
            {
              "x": "2023-12-04T22:50:57.093Z",
              "y": 5239
            },
            {
              "x": "2023-12-05T22:50:57.093Z",
              "y": 5452
            },
            {
              "x": "2023-12-06T22:50:57.093Z",
              "y": 5416
            },
            {
              "x": "2023-12-07T22:50:57.093Z",
              "y": 5195
            },
            {
              "x": "2023-12-08T22:50:57.093Z",
              "y": 5119
            },
            {
              "x": "2023-12-09T22:50:57.093Z",
              "y": 4635
            },
            {
              "x": "2023-12-10T22:50:57.093Z",
              "y": 4833
            },
            {
              "x": "2023-12-11T22:50:57.093Z",
              "y": 4584
            },
            {
              "x": "2023-12-12T22:50:57.093Z",
              "y": 4822
            },
            {
              "x": "2023-12-13T22:50:57.093Z",
              "y": 4330
            },
            {
              "x": "2023-12-14T22:50:57.093Z",
              "y": 4582
            },
            {
              "x": "2023-12-15T22:50:57.093Z",
              "y": 4348
            },
            {
              "x": "2023-12-16T22:50:57.093Z",
              "y": 4132
            },
            {
              "x": "2023-12-17T22:50:57.093Z",
              "y": 4099
            },
            {
              "x": "2023-12-18T22:50:57.093Z",
              "y": 3849
            },
            {
              "x": "2023-12-19T22:50:57.093Z",
              "y": 4010
            },
            {
              "x": "2023-12-20T22:50:57.093Z",
              "y": 4486
            },
            {
              "x": "2023-12-21T22:50:57.093Z",
              "y": 4403
            },
            {
              "x": "2023-12-22T22:50:57.093Z",
              "y": 4141
            },
            {
              "x": "2023-12-23T22:50:57.093Z",
              "y": 3780
            },
            {
              "x": "2023-12-24T22:50:57.093Z",
              "y": 3929
            },
            {
              "x": "2023-12-25T22:50:57.093Z",
              "y": 3524
            },
            {
              "x": "2023-12-26T22:50:57.093Z",
              "y": 3212
            },
            {
              "x": "2023-12-27T22:50:57.093Z",
              "y": 3568
            },
            {
              "x": "2023-12-28T22:50:57.093Z",
              "y": 3800
            },
            {
              "x": "2023-12-29T22:50:57.093Z",
              "y": 3796
            },
            {
              "x": "2023-12-30T22:50:57.093Z",
              "y": 3870
            },
            {
              "x": "2023-12-31T22:50:57.093Z",
              "y": 3745
            },
            {
              "x": "2024-01-01T22:50:57.093Z",
              "y": 3751
            },
            {
              "x": "2024-01-02T22:50:57.093Z",
              "y": 3310
            },
            {
              "x": "2024-01-03T22:50:57.093Z",
              "y": 3509
            },
            {
              "x": "2024-01-04T22:50:57.093Z",
              "y": 3311
            },
            {
              "x": "2024-01-05T22:50:57.093Z",
              "y": 3187
            },
            {
              "x": "2024-01-06T22:50:57.093Z",
              "y": 2918
            },
            {
              "x": "2024-01-07T22:50:57.093Z",
              "y": 3191
            },
            {
              "x": "2024-01-08T22:50:57.093Z",
              "y": 3437
            },
            {
              "x": "2024-01-09T22:50:57.093Z",
              "y": 3291
            },
            {
              "x": "2024-01-10T22:50:57.093Z",
              "y": 3317
            },
            {
              "x": "2024-01-11T22:50:57.093Z",
              "y": 3716
            },
            {
              "x": "2024-01-12T22:50:57.093Z",
              "y": 3260
            },
            {
              "x": "2024-01-13T22:50:57.093Z",
              "y": 3694
            },
            {
              "x": "2024-01-14T22:50:57.093Z",
              "y": 3598
            },
            {
              "x": "2024-01-15T22:50:57.093Z",
              "y": 3812
            }
          ]
        },
        {
          "name": "Visitors",
          "data": [
            {
              "x": "2023-11-12T22:50:57.093Z",
              "y": 1654
            },
            {
              "x": "2023-11-13T22:50:57.093Z",
              "y": 1900
            },
            {
              "x": "2023-11-14T22:50:57.093Z",
              "y": 1647
            },
            {
              "x": "2023-11-15T22:50:57.093Z",
              "y": 1315
            },
            {
              "x": "2023-11-16T22:50:57.093Z",
              "y": 1807
            },
            {
              "x": "2023-11-17T22:50:57.093Z",
              "y": 1793
            },
            {
              "x": "2023-11-18T22:50:57.093Z",
              "y": 1892
            },
            {
              "x": "2023-11-19T22:50:57.093Z",
              "y": 1846
            },
            {
              "x": "2023-11-20T22:50:57.093Z",
              "y": 1966
            },
            {
              "x": "2023-11-21T22:50:57.093Z",
              "y": 1804
            },
            {
              "x": "2023-11-22T22:50:57.093Z",
              "y": 1778
            },
            {
              "x": "2023-11-23T22:50:57.093Z",
              "y": 2015
            },
            {
              "x": "2023-11-24T22:50:57.093Z",
              "y": 1892
            },
            {
              "x": "2023-11-25T22:50:57.093Z",
              "y": 1708
            },
            {
              "x": "2023-11-26T22:50:57.093Z",
              "y": 1711
            },
            {
              "x": "2023-11-27T22:50:57.093Z",
              "y": 1570
            },
            {
              "x": "2023-11-28T22:50:57.093Z",
              "y": 1507
            },
            {
              "x": "2023-11-29T22:50:57.093Z",
              "y": 1451
            },
            {
              "x": "2023-11-30T22:50:57.093Z",
              "y": 1522
            },
            {
              "x": "2023-12-01T22:50:57.093Z",
              "y": 1801
            },
            {
              "x": "2023-12-02T22:50:57.093Z",
              "y": 1977
            },
            {
              "x": "2023-12-03T22:50:57.093Z",
              "y": 2367
            },
            {
              "x": "2023-12-04T22:50:57.093Z",
              "y": 2798
            },
            {
              "x": "2023-12-05T22:50:57.093Z",
              "y": 3080
            },
            {
              "x": "2023-12-06T22:50:57.093Z",
              "y": 2856
            },
            {
              "x": "2023-12-07T22:50:57.093Z",
              "y": 2745
            },
            {
              "x": "2023-12-08T22:50:57.093Z",
              "y": 2750
            },
            {
              "x": "2023-12-09T22:50:57.093Z",
              "y": 2728
            },
            {
              "x": "2023-12-10T22:50:57.093Z",
              "y": 2436
            },
            {
              "x": "2023-12-11T22:50:57.093Z",
              "y": 2289
            },
            {
              "x": "2023-12-12T22:50:57.093Z",
              "y": 2657
            },
            {
              "x": "2023-12-13T22:50:57.093Z",
              "y": 2804
            },
            {
              "x": "2023-12-14T22:50:57.093Z",
              "y": 2777
            },
            {
              "x": "2023-12-15T22:50:57.093Z",
              "y": 3024
            },
            {
              "x": "2023-12-16T22:50:57.093Z",
              "y": 2657
            },
            {
              "x": "2023-12-17T22:50:57.093Z",
              "y": 2218
            },
            {
              "x": "2023-12-18T22:50:57.093Z",
              "y": 1964
            },
            {
              "x": "2023-12-19T22:50:57.093Z",
              "y": 1674
            },
            {
              "x": "2023-12-20T22:50:57.093Z",
              "y": 1721
            },
            {
              "x": "2023-12-21T22:50:57.093Z",
              "y": 2005
            },
            {
              "x": "2023-12-22T22:50:57.093Z",
              "y": 1613
            },
            {
              "x": "2023-12-23T22:50:57.093Z",
              "y": 1295
            },
            {
              "x": "2023-12-24T22:50:57.093Z",
              "y": 1071
            },
            {
              "x": "2023-12-25T22:50:57.093Z",
              "y": 799
            },
            {
              "x": "2023-12-26T22:50:57.093Z",
              "y": 1133
            },
            {
              "x": "2023-12-27T22:50:57.093Z",
              "y": 1536
            },
            {
              "x": "2023-12-28T22:50:57.093Z",
              "y": 2016
            },
            {
              "x": "2023-12-29T22:50:57.093Z",
              "y": 2256
            },
            {
              "x": "2023-12-30T22:50:57.093Z",
              "y": 1934
            },
            {
              "x": "2023-12-31T22:50:57.093Z",
              "y": 1832
            },
            {
              "x": "2024-01-01T22:50:57.093Z",
              "y": 2075
            },
            {
              "x": "2024-01-02T22:50:57.093Z",
              "y": 1709
            },
            {
              "x": "2024-01-03T22:50:57.093Z",
              "y": 1932
            },
            {
              "x": "2024-01-04T22:50:57.093Z",
              "y": 1831
            },
            {
              "x": "2024-01-05T22:50:57.093Z",
              "y": 1434
            },
            {
              "x": "2024-01-06T22:50:57.093Z",
              "y": 993
            },
            {
              "x": "2024-01-07T22:50:57.093Z",
              "y": 1064
            },
            {
              "x": "2024-01-08T22:50:57.093Z",
              "y": 618
            },
            {
              "x": "2024-01-09T22:50:57.093Z",
              "y": 1032
            },
            {
              "x": "2024-01-10T22:50:57.093Z",
              "y": 1280
            },
            {
              "x": "2024-01-11T22:50:57.093Z",
              "y": 1344
            },
            {
              "x": "2024-01-12T22:50:57.093Z",
              "y": 1835
            },
            {
              "x": "2024-01-13T22:50:57.093Z",
              "y": 2287
            },
            {
              "x": "2024-01-14T22:50:57.093Z",
              "y": 2226
            },
            {
              "x": "2024-01-15T22:50:57.093Z",
              "y": 2692
            }
          ]
        }
      ]
    },
    "newVsReturning": {
      "uniqueVisitors": 46085,
      "series": [
        80,
        20
      ],
      "labels": [
        "New",
        "Returning"
      ]
    },
    "gender": {
      "uniqueVisitors": 46085,
      "series": [
        55,
        45
      ],
      "labels": [
        "Male",
        "Female"
      ]
    },
    "age": {
      "uniqueVisitors": 46085,
      "series": [
        35,
        65
      ],
      "labels": [
        "Under 30",
        "Over 30"
      ]
    },
    "language": {
      "uniqueVisitors": 46085,
      "series": [
        25,
        75
      ],
      "labels": [
        "English",
        "Other"
      ]
    }
  }

  public chartVisitorsVsPageViews = {
    chart: {
      animations: {
        enabled: false,
      },
      fontFamily: 'inherit',
      foreColor: 'inherit',
      height: '100%',
      type: 'area',
      toolbar: {
        show: false,
      },
      zoom: {
        enabled: false,
      },
    },
    colors: ['#64748B', '#94A3B8'],
    dataLabels: {
      enabled: false,
    },
    fill: {
      colors: ['#64748B', '#94A3B8'],
      opacity: 0.5,
    },
    grid: {
      show: false,
      padding: {
        bottom: -40,
        left: 0,
        right: 0,
      },
    },
    legend: {
      show: false,
    },
    series: this.data.visitorsVsPageViews.series,
    stroke: {
      curve: 'smooth',
      width: 2,
    },
    tooltip: {
      followCursor: true,
      theme: 'dark',
      x: {
        format: 'MMM dd, yyyy',
      },
    },
    xaxis: {
      axisBorder: {
        show: false,
      },
      labels: {
        offsetY: -20,
        rotate: 0,
        style: {
          colors: 'var(--fuse-text-secondary)',
        },
      },
      tickAmount: 3,
      tooltip: {
        enabled: false,
      },
      type: 'datetime',
    },
    yaxis: {
      labels: {
        style: {
          colors: 'var(--fuse-text-secondary)',
        },
      },
      max: (max): number => max + 250,
      min: (min): number => min - 250,
      show: false,
      tickAmount: 5,
    },
  };

  public formFilters = this.formBuilder.group({
    user: [{ value: '', disabled: false }],
    business: [{ value: '', disabled: false }],
    campaign: [{ value: '', disabled: false }],
    rangeDateStart: [{ value: '', disabled: false }],
    rangeDateEnd: [{ value: '', disabled: false }],
  });

  public catBusiness: entityGeneral.DataCatBusiness[] = [];
  public catAgents: entityGeneral.DataCatAgents[] = [];
  public catCampaing: entityGeneral.DataCatCampaing[] = [];

  public chartWeeklyExpenses: ApexOptions = {};
  public chartGithubIssues: ApexOptions = {};

  public selectedProject: string = 'Estadísticas';
  public filterDayMonthYear: string = 'Mes'

  public fechaHoy = new Date();

  public objStatics: any;

  public latestRegisteredCompanies: any[] = []
  public customersPurchasedMost: any[] = []
  public countriesBuyMost: any[] = []

  constructor(
    private catalogsServices: CatalogsService,
    private moduleServices: DashboardService,
    private dialog: MatDialog,
    private formBuilder: FormBuilder,
    private router: Router
  ) { }

  ngOnInit(): void {
    this.searchWithFilters();
    this.getCatalogs();

  }

  ngAfterViewInit(): void {
    //this.getHomeStatics()

    setTimeout(() => {
      this.getCatalogs()
    }, 500);
  }

  getCatalogs() {
    this.catalogsServices.getCatBusiness().pipe(takeUntil(this.onDestroy)).subscribe({
      next: (data: entityGeneral.DataCatBusiness[]) => {
        this.catBusiness = data;
      },
      error: (error) => console.error(error)
    });

    this.catalogsServices.getCatAgents().pipe(takeUntil(this.onDestroy)).subscribe({
      next: (data: entityGeneral.DataCatAgents[]) => {
        this.catAgents = data;
      },
      error: (error) => console.error(error)
    });

    this.catalogsServices.getCatCampaing().subscribe({
      next: (data: entityGeneral.DataCatCampaing[]) => {
        this.catCampaing = data;
      },
      error: (error) => console.error(error)
    });
  }

  searchWithFilters() {
    let filters: string = '';

    if (this.formFilters.get('user').value) filters += `user_id=${this.formFilters.get('user').value}&`;
    if (this.formFilters.get('business').value) filters += `business_id=${this.formFilters.get('business').value}&`;
    if (this.formFilters.get('campaign').value) filters += `campaign_id=${this.formFilters.get('campaign').value}&`;
    if (this.formFilters.get('rangeDateStart').value && this.formFilters.get('rangeDateEnd').value) {
      filters += `register_date_start=${moment(this.formFilters.get('rangeDateStart').value).format('YYYY-MM-DD')}&`,
        filters += `register_date_end=${moment(this.formFilters.get('rangeDateEnd').value).format('YYYY-MM-DD')}&`
    }

    if (!this.formFilters.get('user').value && !this.formFilters.get('business').value && !this.formFilters.get('campaign').value && !this.formFilters.get('rangeDateStart').value && !this.formFilters.get('rangeDateEnd').value) {
      if (this.filterDayMonthYear == 'Día') filters += `current_day=true&`
      else if (this.filterDayMonthYear == 'Mes') filters += `current_month=true&`
      else filters += `current_year=true&`
    }
    
    this.getHomeStatics(filters)
  }

  getHomeStatics(filters?: string) {
    this.moduleServices.getHomeStatics(filters).subscribe({
      next: (data: entity.DatsStaticsMapper) => {
        console.log('data => ', data);
        
        this.objStatics = data;
        this.latestRegisteredCompanies = data.latestRegisteredCompanies
        this.customersPurchasedMost = data.customersPurchasedMost
        this.countriesBuyMost = data.countriesBuyMost
      },
      error: (error) => console.error(error)
    })
  }

  dataGraphics() {
    this.chartWeeklyExpenses = {
      chart: {
        animations: {
          enabled: false,
        },
        fontFamily: 'inherit',
        foreColor: 'inherit',
        height: '100%',
        type: 'line',
        sparkline: {
          enabled: true,
        },
      },
      colors: ['#22D3EE'],
      series: [
        {
          name: "Expenses",
          data: [
            4412,
            4345,
            4541,
            4677,
            4322,
            4123
          ]
        }
      ],
      stroke: {
        curve: 'smooth',
      },
      tooltip: {
        theme: 'dark',
      },
      xaxis: {
        type: 'category',
        categories: [
          "26 Oct - 02 Nov",
          "03 Nov - 10 Nov",
          "11 Nov - 18 Nov",
          "19 Nov - 26 Nov",
          "27 Nov - 04 Dec",
          "05 Dec - 12 Dec"
        ],
      },
      yaxis: {
        labels: {
          formatter: (val): string => `$${val}`,
        },
      },
    }

    this.chartGithubIssues = {
      chart: {
        fontFamily: 'inherit',
        foreColor: 'inherit',
        height: '100%',
        type: 'line',
        toolbar: {
          show: false,
        },
        zoom: {
          enabled: false,
        },
      },
      colors: ['#64748B', '#94A3B8'],
      dataLabels: {
        enabled: true,
        enabledOnSeries: [0],
        background: {
          borderWidth: 0,
        },
      },
      grid: {
        borderColor: 'var(--fuse-border)',
      },
      labels: ['LUNES', 'MARTES', 'MIERCOLES', 'JUEVES', 'VIERNES', 'SABADO', 'DOMINGO'],
      legend: {
        show: false,
      },
      plotOptions: {
        bar: {
          columnWidth: '50%',
        },
      },
      series: [
        {
          name: "Productos",
          type: "line",
          data: [
            0,
            0,
            0,
            0,
            0,
            0,
            0
          ]
        },
        {
          name: "Lugares",
          type: "column",
          data: [
            9,
            8,
            10,
            12,
            7,
            11,
            15
          ]
        }
      ],
      states: {
        hover: {
          filter: {
            type: 'darken',
            value: 0.75,
          },
        },
      },
      stroke: {
        width: [3, 0],
      },
      tooltip: {
        followCursor: true,
        theme: 'dark',
      },
      xaxis: {
        axisBorder: {
          show: false,
        },
        axisTicks: {
          color: 'var(--fuse-border)',
        },
        labels: {
          style: {
            colors: 'var(--fuse-text-secondary)',
          },
        },
        tooltip: {
          enabled: false,
        },
      },
      yaxis: {
        labels: {
          offsetX: -16,
          style: {
            colors: 'var(--fuse-text-secondary)',
          },
        },
      },
    };
  }


  selectOption(option: string) {
    this.filterDayMonthYear = option;
    this.searchWithFilters();
  }
  
  ngOnDestroy(): void {
    this.onDestroy.next();
    this.onDestroy.unsubscribe();
  }
}

